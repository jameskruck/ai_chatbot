<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phase 2: In-Session Work – Retail Chatbot Course</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- ====== Header / Navigation ====== -->
  <header class="hero fade-in">
    <div>
      <h1 class="hero-title">Building a Retail Chatbot</h1>
      <p class="hero-subtitle">Phase 2: In-Session Work</p>
      <nav class="navigation">
        <ul>
          <li><a href="index.html">Prep Work</a></li>
          <li><a href="in-session.html" aria-current="page">In-Session Work</a></li>
          <li><a href="post-work.html">Post-Session Work</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <!-- ====== End Header ====== -->

  <main>
    <!-- ====== Phase 2: FashionForward Case ====== -->
    <section id="case-intro" class="fade-in-up">
      <div class="progress-bar">
        <div class="progress" 
             role="progressbar" aria-valuenow="66" 
             aria-valuemin="0" aria-valuemax="100"
             style="width: 66%;"></div>
      </div>

      <h2>Case Scenario: FashionForward T-Shirts</h2>
      
      <div class="case-background card">
        <h3>📧 The Customer Service Crisis</h3>
        <p>
          <strong>FashionForward</strong> is a growing online t-shirt retailer. They receive over 50 daily emails 
          about the same questions—sizing, fabric care, returns, and shipping. Their small customer 
          service team is overwhelmed; response times are slipping, and customer satisfaction is falling. 
          The owner wants an AI-powered chatbot to handle FAQs but doesn't know where to start.
        </p>
        
        <div class="case-details">
          <div class="detail-box">
            <h4>📊 Current Situation</h4>
            <ul>
              <li>50+ repetitive emails daily</li>
              <li>Response time: 24-48 hours</li>
              <li>Customer satisfaction: Declining</li>
              <li>Staff: Overwhelmed</li>
            </ul>
          </div>
          
          <div class="detail-box">
            <h4>🎯 Business Goals</h4>
            <ul>
              <li>Reduce response times</li>
              <li>Free up staff for complex issues</li>
              <li>Improve customer satisfaction</li>
              <li>Scale customer service efficiently</li>
            </ul>
          </div>
        </div>

        <div class="sample-emails">
          <h4>📝 Sample Customer Emails</h4>
          <div class="email-grid">
            <div class="email-sample">
              <em>"What sizes do you carry—I'm usually a Large."</em>
            </div>
            <div class="email-sample">
              <em>"How do I wash this shirt? Will it shrink?"</em>
            </div>
            <div class="email-sample">
              <em>"I need to return a shirt—what's your policy?"</em>
            </div>
            <div class="email-sample">
              <em>"When will my order ship? Tracking not updating."</em>
            </div>
            <div class="email-sample">
              <em>"Can I exchange a shirt for a different color?"</em>
            </div>
            <div class="email-sample">
              <em>"Do you have this design in XL?"</em>
            </div>
          </div>
        </div>
      </div>

      <div class="tutor-intro card">
        <h3>🤝 Meet Your AI Collaboration Partner</h3>
        <p>
          Now that you understand FashionForward's situation, you'll work <strong>with</strong> an AI peer to analyze 
          this case and develop a chatbot solution. Think of this as brainstorming with a smart colleague who's 
          just as invested in solving this puzzle as you are.
        </p>
        <p><strong>Your Goal Together:</strong> Develop concrete recommendations for FashionForward's chatbot strategy.</p>
        <div class="collaboration-goals">
          <h4>🎯 What You'll Figure Out Together:</h4>
          <ul>
            <li>📊 Top 3 customer pain points (ranked by business impact)</li>
            <li>💬 5 specific chatbot responses that match FashionForward's brand</li>
            <li>🚀 Concrete rollout plan with timeline</li>
            <li>📈 Success metrics to track effectiveness</li>
          </ul>
        </div>
        <button id="start-tutoring" class="btn-primary">🚀 Start Collaborating</button>
      </div>
    </section>

    <!-- AI Tutoring Interface -->
    <section id="ai-tutoring" class="fade-in-up hidden">
      <div class="chat-container">
        <div class="chat-header">
          <h3>💬 AI Collaboration Partner - FashionForward Case</h3>
          <div class="session-info">
            <span id="session-status">Collaboration Active</span>
            <span id="progress-indicator">Getting Started</span>
          </div>
        </div>
        
        <div id="chat-messages" class="chat-messages">
          <!-- Messages will be populated here -->
        </div>
        
        <div class="chat-input-container">
          <div class="input-group">
            <textarea id="user-input" 
                      placeholder="Type your response here..." 
                      rows="3"
                      disabled></textarea>
            <button id="send-message" class="btn-send" disabled>
              <span class="send-text">Send</span>
              <span class="send-icon">📤</span>
            </button>
          </div>
          <div class="input-hints">
            <small>💡 Take your time to think through each question. The AI tutor is here to guide your learning.</small>
          </div>
        </div>
      </div>
    </section>

    <!-- Session Summary -->
    <section id="session-summary" class="fade-in-up hidden">
      <div class="card">
        <h3>📋 Your Case Analysis Summary</h3>
        <div id="summary-content">
          <!-- Will be populated by AI -->
        </div>
        <div class="summary-actions">
          <button id="download-summary" class="btn-primary">📄 Download Summary</button>
          <button id="continue-course" class="btn-primary">Continue to Implementation →</button>
        </div>
      </div>
    </section>

    <!-- ====== Navigation Buttons ====== -->
    <div class="navigation-buttons">
      <a href="index.html" class="btn-primary">← Back: Prep Work</a>
      <a href="post-work.html" class="btn-primary">Next: Post-Session Work →</a>
    </div>
  </main>

  <!-- ====== Footer ====== -->
  <footer>
    <p>&copy; 2025 James Kruck</p>
  </footer>

  <!-- ====== JavaScript for AI Tutoring ====== -->
  <script>
    class ChatbotTutor {
      constructor() {
        this.sessionId = this.generateSessionId();
        this.messageCount = 0;
        this.currentStage = 'introduction';
        this.userResponses = [];
        this.isWaitingForResponse = false;
        
        this.initializeEventListeners();
      }
      
      generateSessionId() {
        return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }
      
      initializeEventListeners() {
        document.getElementById('start-tutoring').addEventListener('click', () => {
          this.startTutoringSession();
        });
        
        document.getElementById('send-message').addEventListener('click', () => {
          this.sendMessage();
        });
        
        document.getElementById('user-input').addEventListener('keypress', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendMessage();
          }
        });
        
        document.getElementById('continue-course').addEventListener('click', () => {
          window.location.href = 'post-work.html';
        });
        
        document.getElementById('download-summary').addEventListener('click', () => {
          this.downloadSummary();
        });
      }
      
      async startTutoringSession() {
        document.getElementById('case-intro').style.display = 'none';
        document.getElementById('ai-tutoring').classList.remove('hidden');
        
        // Enable input
        document.getElementById('user-input').disabled = false;
        document.getElementById('send-message').disabled = false;
        
        // Start the conversation
        await this.sendInitialMessage();
      }
      
      async sendInitialMessage() {
        const initialPrompt = `You are an expert AI tutor guiding a learner through a retail chatbot case study. The learner has just read about FashionForward T-Shirts' customer service crisis.

Your role:
1. Guide them through analyzing the case using Socratic questioning
2. Help them identify pain points, prioritize solutions, and design responses
3. Keep responses engaging, supportive, and educational
4. Ask one focused question at a time
5. Build on their responses to deepen understanding

Case Context: FashionForward gets 50+ daily emails about sizing, returns, shipping, and fabric care. Response times are 24-48 hours, customer satisfaction is declining.

Start by greeting the learner and asking them what they think is the biggest problem FashionForward is facing based on what they just read. Keep it conversational and encouraging.`;

        await this.callAI(initialPrompt, true);
      }
      
      async sendMessage() {
        const userInput = document.getElementById('user-input');
        const message = userInput.value.trim();
        
        if (!message || this.isWaitingForResponse) return;
        
        // Add user message to chat
        this.addMessageToChat('user', message);
        userInput.value = '';
        
        // Store user response
        this.userResponses.push({
          stage: this.currentStage,
          question: this.lastAIQuestion,
          response: message,
          timestamp: new Date().toISOString()
        });
        
        // Send to AI tutor
        await this.callAI(message, false);
      }
      
      async callAI(message, isInitial = false) {
        this.isWaitingForResponse = true;
        this.updateSendButton(true);
        
        if (!isInitial) {
          this.addTypingIndicator();
        }
        
        try {
          const response = await fetch('https://ai-chatbot-oise.onrender.com/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              user_id: this.sessionId,
              message: message,
              session_data: {
                stage: this.currentStage,
                messageCount: this.messageCount,
                userResponses: this.userResponses
              }
            })
          });
          
          const data = await response.json();
          
          if (data.error) {
            throw new Error(data.error);
          }
          
          this.removeTypingIndicator();
          this.addMessageToChat('ai', data.response);
          this.lastAIQuestion = data.response;
          this.messageCount++;
          
          // Update progress
          this.updateProgress();
          
        } catch (error) {
          this.removeTypingIndicator();
          this.addMessageToChat('ai', 'I apologize, but I\'m having trouble connecting right now. Please try again in a moment.');
          console.error('AI Tutor Error:', error);
        }
        
        this.isWaitingForResponse = false;
        this.updateSendButton(false);
      }
      
      addMessageToChat(sender, message) {
        const chatMessages = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        
        const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        messageDiv.innerHTML = `
          <div class="message-content">
            <div class="message-header">
              <span class="sender">${sender === 'ai' ? '🤝 AI Partner' : '👤 You'}</span>
              <span class="timestamp">${timestamp}</span>
            </div>
            <div class="message-text">${message.replace(/\n/g, '<br>')}</div>
          </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Check if conversation should end
        if (this.messageCount >= 8) {
          setTimeout(() => this.endTutoringSession(), 2000);
        }
      }
      
      addTypingIndicator() {
        const chatMessages = document.getElementById('chat-messages');
        const typingDiv = document.createElement('div');
        typingDiv.className = 'message ai-message typing-indicator';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
          <div class="message-content">
            <div class="message-header">
              <span class="sender">🤝 AI Partner</span>
            </div>
            <div class="typing-animation">
              <span></span><span></span><span></span>
            </div>
          </div>
        `;
        
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      removeTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }
      
      updateSendButton(isLoading) {
        const sendButton = document.getElementById('send-message');
        const userInput = document.getElementById('user-input');
        
        sendButton.disabled = isLoading;
        userInput.disabled = isLoading;
        
        if (isLoading) {
          sendButton.innerHTML = '<span class="loading-spinner">⏳</span>';
        } else {
          sendButton.innerHTML = '<span class="send-text">Send</span><span class="send-icon">📤</span>';
        }
      }
      
      updateProgress() {
        const progressIndicator = document.getElementById('progress-indicator');
        const stages = ['Getting Started', 'Problem Analysis', 'Solution Design', 'Implementation Planning', 'Finalizing Recommendations'];
        const stageIndex = Math.min(Math.floor(this.messageCount / 2), stages.length - 1);
        progressIndicator.textContent = stages[stageIndex];
      }
      
      async endTutoringSession() {
        document.getElementById('user-input').disabled = true;
        document.getElementById('send-message').disabled = true;
        document.getElementById('session-status').textContent = 'Collaboration Complete';
        
        // Generate summary
        await this.generateSummary();
        
        document.getElementById('session-summary').classList.remove('hidden');
        document.getElementById('session-summary').scrollIntoView({ behavior: 'smooth' });
      }
      
      async generateSummary() {
        const summaryContent = document.getElementById('summary-content');
        summaryContent.innerHTML = '<div class="loading">🤝 Generating your collaborative case solution summary...</div>';
        
        try {
          const summaryPrompt = `Based on this tutoring session about the FashionForward chatbot case, generate a personalized summary for the learner.

Session Data:
${JSON.stringify(this.userResponses, null, 2)}

Please provide:
1. Key insights they demonstrated
2. Their problem-solving approach
3. Strengths in their analysis
4. Areas for further consideration
5. Next steps for implementation

Make it encouraging and specific to their responses. Format nicely with headers and bullet points.`;

          const response = await fetch('https://ai-chatbot-oise.onrender.com/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              user_id: this.sessionId + '_summary',
              message: summaryPrompt
            })
          });
          
          const data = await response.json();
          summaryContent.innerHTML = `<div class="summary-text">${data.response.replace(/\n/g, '<br>')}</div>`;
          
        } catch (error) {
          summaryContent.innerHTML = '<div class="error">Unable to generate summary at this time.</div>';
        }
      }
      
      downloadSummary() {
        const summaryText = document.getElementById('summary-content').textContent;
        const blob = new Blob([summaryText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'FashionForward_Case_Analysis_Summary.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    }
    
    // Initialize the chatbot tutor when page loads
    window.addEventListener('DOMContentLoaded', () => {
      new ChatbotTutor();
    });
  </script>

  <!-- ====== Styles for AI Tutoring Interface ====== -->
  <style>
    .case-background {
      margin-bottom: 25px;
    }
    
    .case-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    
    .detail-box {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid var(--primary-color);
    }
    
    .detail-box h4 {
      margin-top: 0;
      color: var(--secondary-color);
    }
    
    .email-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .email-sample {
      background: #fff3cd;
      padding: 12px;
      border-radius: 6px;
      border-left: 3px solid #ffc107;
      font-style: italic;
      font-size: 0.9em;
    }
    
    .tutor-intro {
      background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
      border: 2px solid #4CAF50;
    }
    
    .chat-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .chat-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chat-header h3 {
      margin: 0;
      color: white;
    }
    
    .session-info {
      display: flex;
      flex-direction: column;
      text-align: right;
      font-size: 0.9em;
    }
    
    .chat-messages {
      height: 400px;
      overflow-y: auto;
      padding: 20px;
      background: #fafafa;
    }
    
    .message {
      margin-bottom: 20px;
      animation: slideIn 0.3s ease-out;
    }
    
    .message-content {
      max-width: 80%;
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .user-message .message-content {
      margin-left: auto;
      background: var(--primary-color);
      color: white;
    }
    
    .ai-message .message-content {
      margin-right: auto;
      background: white;
      border: 1px solid #e0e0e0;
    }
    
    .message-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.8em;
      opacity: 0.8;
    }
    
    .sender {
      font-weight: 600;
    }
    
    .message-text {
      line-height: 1.5;
    }
    
    .typing-indicator .message-content {
      padding: 15px 20px;
    }
    
    .typing-animation {
      display: flex;
      gap: 4px;
    }
    
    .typing-animation span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ccc;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-animation span:nth-child(1) { animation-delay: -0.32s; }
    .typing-animation span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
    
    .chat-input-container {
      padding: 20px;
      background: white;
      border-top: 1px solid #e0e0e0;
    }
    
    .input-group {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }
    
    #user-input {
      flex: 1;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 12px;
      resize: none;
      font-family: inherit;
    }
    
    .btn-send {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .btn-send:hover:not(:disabled) {
      background: var(--secondary-color);
      transform: translateY(-1px);
    }
    
    .btn-send:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .input-hints {
      margin-top: 8px;
      text-align: center;
    }
    
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .summary-text {
      line-height: 1.6;
      font-size: 1.1em;
    }
    
    .summary-actions {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    .collaboration-goals {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-left: 4px solid #4CAF50;
    }
    
    .collaboration-goals h4 {
      margin-top: 0;
      color: var(--secondary-color);
    }
    
    .collaboration-goals ul {
      margin-bottom: 0;
    }
    
    .collaboration-goals li {
      margin-bottom: 8px;
    }
    
    .hidden {
      display: none;
    }
    
    @media (max-width: 600px) {
      .case-details {
        grid-template-columns: 1fr;
      }
      
      .email-grid {
        grid-template-columns: 1fr;
      }
      
      .chat-header {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .message-content {
        max-width: 95%;
      }
    }
  </style>
</body>
</html>